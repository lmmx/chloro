COMPARISON DIFF
============================================================

Original size: 12654 bytes
Chloro size:   12157 bytes
Rustfmt size:  13004 bytes

âœ— Outputs DIFFER

=== DIFF (- rustfmt, + chloro) ===
 }
 
 /// A proc-macro expander implementation.
-pub trait ProcMacroExpander: fmt::Debug + Send + Sync + RefUnwindSafe + Any {
+pub trait ProcMacroExpander {
     /// Run the expander with the given input subtree, optional attribute input subtree (for
     /// [`ProcMacroKind::Attr`]), environment variables, and span information.
     fn expand(
     }
 }
 
-impl Eq for dyn ProcMacroExpander {}
+impl Eq for dyn ProcMacroExpander {
+}
 
 #[derive(Debug)]
 pub enum ProcMacroExpansionError {
 }
 
 pub type ProcMacroLoadResult = Result<Vec<ProcMacro>, ProcMacroLoadingError>;
+
 type StoredProcMacroLoadResult = Result<Box<[ProcMacro]>, ProcMacroLoadingError>;
 
 #[derive(Default, Debug)]
 
 #[derive(Default, Debug)]
 pub struct ProcMacros(FxHashMap<Crate, Arc<CrateProcMacros>>);
+
 impl ProcMacros {
     fn get(&self, krate: Crate) -> Option<Arc<CrateProcMacros>> {
         self.0.get(&krate).cloned()
             }
         };
         proc_macros.get(idx as usize).ok_or_else(|| {
-                ExpandError::other(err_span,
-                    format!(
+            ExpandError::other(
+                err_span,
+                format!(
                         "internal error: proc-macro index out of bounds: the length is {} but the index is {}",
                         proc_macros.len(),
                         idx
-                    )
-                )
-            }
-        )
+                    ),
+            )
+        })
     }
 
     pub fn get_error(&self) -> Option<&ProcMacroLoadingError> {
         def_site_ctx: span::SyntaxContext,
     ) -> Option<Box<[(crate::name::Name, CustomProcMacroExpander, bool)]>> {
         match &self.0 {
-            Ok(proc_macros) => Some(
-                proc_macros
-                    .iter()
-                    .enumerate()
-                    .map(|(idx, it)| {
-                        let name = crate::name::Name::new_symbol(it.name.clone(), def_site_ctx);
-                        (name, CustomProcMacroExpander::new(idx as u32), it.disabled)
-                    })
-                    .collect(),
-            ),
+            Ok(proc_macros) => Some(proc_macros.iter().enumerate().map(|(idx, it)| {
+                let name = crate::name::Name::new_symbol(it.name.clone(), def_site_ctx);
+                (name, CustomProcMacroExpander::new(idx as u32), it.disabled)
+            }).collect(
+            )),
             _ => None,
         }
     }
     pub disabled: bool,
 }
 
-// `#[derive(PartialEq)]` generates a strange "cannot move" error.
 impl PartialEq for ProcMacro {
     fn eq(&self, other: &Self) -> bool {
-        let Self {
-            name,
-            kind,
-            expander,
-            disabled,
-        } = self;
+        let Self { name, kind, expander, disabled } = self;
         let Self {
             name: other_name,
             kind: other_kind,
             expander: other_expander,
             disabled: other_disabled,
         } = other;
-        name == other_name
-            && kind == other_kind
-            && expander == other_expander
-            && disabled == other_disabled
+        name == other_name && kind == other_kind && expander == other_expander && disabled == other_disabled
     }
 }
 
 
 impl CustomProcMacroExpander {
     const MISSING_EXPANDER: u32 = !0;
+
     const DISABLED_ID: u32 = !1;
+
     const PROC_MACRO_ATTR_DISABLED: u32 = !2;
 
     pub fn new(proc_macro_id: u32) -> Self {
 
     /// An expander that always errors due to the actual proc-macro expander missing.
     pub const fn missing_expander() -> Self {
-        Self {
-            proc_macro_id: Self::MISSING_EXPANDER,
-        }
+        Self { proc_macro_id: Self::MISSING_EXPANDER }
     }
 
     /// A dummy expander that always errors. This expander is used for macros that have been disabled.
     pub const fn disabled() -> Self {
-        Self {
-            proc_macro_id: Self::DISABLED_ID,
-        }
+        Self { proc_macro_id: Self::DISABLED_ID }
     }
 
     /// A dummy expander that always errors. This expander is used for attribute macros when
     /// proc-macro attribute expansion is disabled.
     pub const fn disabled_proc_attr() -> Self {
-        Self {
-            proc_macro_id: Self::PROC_MACRO_ATTR_DISABLED,
-        }
+        Self { proc_macro_id: Self::PROC_MACRO_ATTR_DISABLED }
     }
 
     /// The macro-expander is missing or has yet to be build.
         match self.proc_macro_id {
             Self::PROC_MACRO_ATTR_DISABLED => ExpandResult::new(
                 tt::TopSubtree::empty(tt::DelimSpan {
-                    open: call_site,
-                    close: call_site,
-                }),
+                open: call_site,
+                close: call_site,
+            }),
                 ExpandError::new(call_site, ExpandErrorKind::ProcMacroAttrExpansionDisabled),
             ),
             Self::MISSING_EXPANDER => ExpandResult::new(
                 tt::TopSubtree::empty(tt::DelimSpan {
-                    open: call_site,
-                    close: call_site,
-                }),
-                ExpandError::new(
-                    call_site,
-                    ExpandErrorKind::MissingProcMacroExpander(def_crate),
-                ),
+                open: call_site,
+                close: call_site,
+            }),
+                ExpandError::new(call_site, ExpandErrorKind::MissingProcMacroExpander(def_crate)),
             ),
             Self::DISABLED_ID => ExpandResult::new(
                 tt::TopSubtree::empty(tt::DelimSpan {
-                    open: call_site,
-                    close: call_site,
-                }),
+                open: call_site,
+                close: call_site,
+            }),
                 ExpandError::new(call_site, ExpandErrorKind::MacroDisabled),
             ),
             id => {
                         );
                     }
                 };
-
-                // Proc macros have access to the environment variables of the invoking crate.
                 let env = calling_crate.env(db);
-                // FIXME: Can we avoid the string allocation here?
                 let current_dir = calling_crate.data(db).proc_macro_cwd.to_string();
-
                 match proc_macro.expander.expand(
                     tt,
                     attr_arg,
                 ) {
                     Ok(t) => ExpandResult::ok(t),
                     Err(err) => match err {
-                        // Don't discard the item in case something unexpected happened while expanding attributes
-                        ProcMacroExpansionError::System(text)
-                            if proc_macro.kind == ProcMacroKind::Attr =>
-                        {
+                        ProcMacroExpansionError::System(text) if proc_macro.kind == ProcMacroKind::Attr => {
                             ExpandResult {
                                 value: tt.clone(),
                                 err: Some(ExpandError::other(call_site, text)),
                             }
-                        }
+                        },
                         ProcMacroExpansionError::System(text)
                         | ProcMacroExpansionError::Panic(text) => ExpandResult::new(
                             tt::TopSubtree::empty(tt::DelimSpan {
-                                open: call_site,
-                                close: call_site,
-                            }),
+                            open: call_site,
+                            close: call_site,
+                        }),
                             ExpandError::new(
-                                call_site,
-                                ExpandErrorKind::ProcMacroPanic(text.into_boxed_str()),
-                            ),
+                            call_site,
+                            ExpandErrorKind::ProcMacroPanic(text.into_boxed_str()),
+                        ),
                         ),
                     },
                 }
-            }
+            },
         }
     }
 }