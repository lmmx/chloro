COMPARISON DIFF
============================================================

Original size: 39047 bytes
Chloro size:   38816 bytes
Rustfmt size:  42083 bytes

âœ— Outputs DIFFER

=== DIFF (- rustfmt, + chloro) ===
                 }
             )*}
         }
-        f.field("file_id", &self.file_id)
-            .field("full_range", &self.full_range);
+        f.field("file_id", &self.file_id).field("full_range", &self.full_range);
         opt!(focus_range);
         f.field("name", &self.name);
         opt!(kind container_name description docs);
                 virtual_file_id,
                 real_file_id,
             )?,
-            name: self
-                .name
-                .upmap_from_ra_fixture(analysis, virtual_file_id, real_file_id)?,
-            kind: self
-                .kind
-                .upmap_from_ra_fixture(analysis, virtual_file_id, real_file_id)?,
+            name: self.name.upmap_from_ra_fixture(analysis, virtual_file_id, real_file_id)?,
+            kind: self.kind.upmap_from_ra_fixture(analysis, virtual_file_id, real_file_id)?,
             container_name: self.container_name.upmap_from_ra_fixture(
                 analysis,
                 virtual_file_id,
                 virtual_file_id,
                 real_file_id,
             )?,
-            docs: self
-                .docs
-                .upmap_from_ra_fixture(analysis, virtual_file_id, real_file_id)?,
-            alias: self
-                .alias
-                .upmap_from_ra_fixture(analysis, virtual_file_id, real_file_id)?,
+            docs: self.docs.upmap_from_ra_fixture(analysis, virtual_file_id, real_file_id)?,
+            alias: self.alias.upmap_from_ra_fixture(analysis, virtual_file_id, real_file_id)?,
         })
     }
 }
         db: &RootDatabase,
         module: hir::Module,
     ) -> UpmappingResult<NavigationTarget> {
-        let name = module
-            .name(db)
-            .map(|it| it.symbol().clone())
-            .unwrap_or_else(|| sym::underscore);
+        let name = module.name(db).map(|it| it.symbol().clone()).unwrap_or_else(|| sym::underscore);
         match module.declaration_source(db) {
             Some(InFile { value, file_id }) => {
-                orig_range_with_focus(db, file_id, value.syntax(), value.name()).map(
-                    |(
-                        FileRange {
-                            file_id,
-                            range: full_range,
-                        },
-                        focus_range,
-                    )| {
+                orig_range_with_focus(db, file_id, value.syntax(), value.name()).map(|(FileRange { file_id, range: full_range }, focus_range)| {
                         let mut res = NavigationTarget::from_syntax(
                             file_id,
                             name.clone(),
                         );
                         res.docs = module.docs(db);
                         res.description = Some(
-                            module
-                                .display(db, module.krate().to_display_target(db))
-                                .to_string(),
+                            module.display(db, module.krate().to_display_target(db)).to_string(),
                         );
                         res
-                    },
-                )
+                    })
             }
             _ => module.to_nav(db),
         }
         InFile { file_id, value }: InFile<&dyn ast::HasName>,
         kind: SymbolKind,
     ) -> UpmappingResult<NavigationTarget> {
-        let name = value
-            .name()
-            .map(|it| Symbol::intern(&it.text()))
-            .unwrap_or_else(|| sym::underscore);
+        let name =
+            value.name().map(|it| Symbol::intern(&it.text())).unwrap_or_else(|| sym::underscore);
 
-        orig_range_with_focus(db, file_id, value.syntax(), value.name()).map(
-            |(
-                FileRange {
-                    file_id,
-                    range: full_range,
-                },
-                focus_range,
-            )| {
+        orig_range_with_focus(db, file_id, value.syntax(), value.name()).map(|(FileRange { file_id, range: full_range }, focus_range)| {
                 NavigationTarget::from_syntax(file_id, name.clone(), focus_range, full_range, kind)
-            },
-        )
+            })
     }
 
     pub(crate) fn from_syntax(
                 self.loc.ptr.text_range(),
                 Some(self.loc.name_ptr.text_range()),
             )
-            .map(
-                |(
-                    FileRange {
-                        file_id,
-                        range: full_range,
-                    },
+            .map(|(FileRange { file_id, range: full_range }, focus_range)| {
+                NavigationTarget {
+                    file_id,
+                    name: self
+                        .is_alias
+                        .then(|| self.def.name(db))
+                        .flatten()
+                        .map_or_else(|| self.name.clone(), |it| it.symbol().clone()),
+                    alias: self.is_alias.then(|| self.name.clone()),
+                    kind: Some(self.def.into()),
+                    full_range,
                     focus_range,
-                )| {
-                    NavigationTarget {
-                        file_id,
-                        name: self
-                            .is_alias
-                            .then(|| self.def.name(db))
-                            .flatten()
-                            .map_or_else(|| self.name.clone(), |it| it.symbol().clone()),
-                        alias: self.is_alias.then(|| self.name.clone()),
-                        kind: Some(self.def.into()),
-                        full_range,
-                        focus_range,
-                        container_name: self.container_name.clone(),
-                        description: match self.def {
-                            hir::ModuleDef::Module(it) => {
-                                Some(it.display(db, display_target).to_string())
-                            }
-                            hir::ModuleDef::Function(it) => {
-                                Some(it.display(db, display_target).to_string())
-                            }
-                            hir::ModuleDef::Adt(it) => {
-                                Some(it.display(db, display_target).to_string())
-                            }
-                            hir::ModuleDef::Variant(it) => {
-                                Some(it.display(db, display_target).to_string())
-                            }
-                            hir::ModuleDef::Const(it) => {
-                                Some(it.display(db, display_target).to_string())
-                            }
-                            hir::ModuleDef::Static(it) => {
-                                Some(it.display(db, display_target).to_string())
-                            }
-                            hir::ModuleDef::Trait(it) => {
-                                Some(it.display(db, display_target).to_string())
-                            }
-                            hir::ModuleDef::TypeAlias(it) => {
-                                Some(it.display(db, display_target).to_string())
-                            }
-                            hir::ModuleDef::Macro(it) => {
-                                Some(it.display(db, display_target).to_string())
-                            }
-                            hir::ModuleDef::BuiltinType(_) => None,
-                        },
-                        docs: None,
-                    }
-                },
-            ),
+                    container_name: self.container_name.clone(),
+                    description: match self.def {
+                        hir::ModuleDef::Module(it) => {
+                            Some(it.display(db, display_target).to_string())
+                        }
+                        hir::ModuleDef::Function(it) => {
+                            Some(it.display(db, display_target).to_string())
+                        }
+                        hir::ModuleDef::Adt(it) => Some(it.display(db, display_target).to_string()),
+                        hir::ModuleDef::Variant(it) => {
+                            Some(it.display(db, display_target).to_string())
+                        }
+                        hir::ModuleDef::Const(it) => {
+                            Some(it.display(db, display_target).to_string())
+                        }
+                        hir::ModuleDef::Static(it) => {
+                            Some(it.display(db, display_target).to_string())
+                        }
+                        hir::ModuleDef::Trait(it) => {
+                            Some(it.display(db, display_target).to_string())
+                        }
+                        hir::ModuleDef::TypeAlias(it) => {
+                            Some(it.display(db, display_target).to_string())
+                        }
+                        hir::ModuleDef::Macro(it) => {
+                            Some(it.display(db, display_target).to_string())
+                        }
+                        hir::ModuleDef::BuiltinType(_) => None,
+                    },
+                    docs: None,
+                }
+            }),
         )
     }
 }
     }
 }
 
-pub(crate) trait ToNavFromAst: Sized {
+pub(crate) trait ToNavFromAst {
     const KIND: SymbolKind;
+
     fn container_name(self, db: &RootDatabase) -> Option<Symbol> {
         _ = db;
         None
 
 impl ToNavFromAst for hir::Function {
     const KIND: SymbolKind = SymbolKind::Function;
+
     fn container_name(self, db: &RootDatabase) -> Option<Symbol> {
         container_name(db, self)
     }
 
 impl ToNavFromAst for hir::Const {
     const KIND: SymbolKind = SymbolKind::Const;
+
     fn container_name(self, db: &RootDatabase) -> Option<Symbol> {
         container_name(db, self)
     }
 }
+
 impl ToNavFromAst for hir::Static {
     const KIND: SymbolKind = SymbolKind::Static;
+
     fn container_name(self, db: &RootDatabase) -> Option<Symbol> {
         container_name(db, self)
     }
 }
+
 impl ToNavFromAst for hir::Struct {
     const KIND: SymbolKind = SymbolKind::Struct;
+
     fn container_name(self, db: &RootDatabase) -> Option<Symbol> {
         container_name(db, self)
     }
 }
+
 impl ToNavFromAst for hir::Enum {
     const KIND: SymbolKind = SymbolKind::Enum;
+
     fn container_name(self, db: &RootDatabase) -> Option<Symbol> {
         container_name(db, self)
     }
 }
+
 impl ToNavFromAst for hir::Variant {
     const KIND: SymbolKind = SymbolKind::Variant;
 }
+
 impl ToNavFromAst for hir::Union {
     const KIND: SymbolKind = SymbolKind::Union;
+
     fn container_name(self, db: &RootDatabase) -> Option<Symbol> {
         container_name(db, self)
     }
 }
+
 impl ToNavFromAst for hir::TypeAlias {
     const KIND: SymbolKind = SymbolKind::TypeAlias;
+
     fn container_name(self, db: &RootDatabase) -> Option<Symbol> {
         container_name(db, self)
     }
 }
+
 impl ToNavFromAst for hir::Trait {
     const KIND: SymbolKind = SymbolKind::Trait;
+
     fn container_name(self, db: &RootDatabase) -> Option<Symbol> {
         container_name(db, self)
     }
             .map(|mut res| {
                 res.docs = self.docs(db);
                 res.description = hir::attach_db(db, || {
-                    Some(
-                        self.display(db, self.krate(db).to_display_target(db))
-                            .to_string(),
-                    )
+                    Some(self.display(db, self.krate(db).to_display_target(db)).to_string())
                 });
                 res.container_name = self.container_name(db);
                 res
     fn to_nav(&self, db: &RootDatabase) -> UpmappingResult<NavigationTarget> {
         let InFile { file_id, value } = self.definition_source(db);
 
-        let name = self
-            .name(db)
-            .map(|it| it.symbol().clone())
-            .unwrap_or_else(|| sym::underscore);
+        let name = self.name(db).map(|it| it.symbol().clone()).unwrap_or_else(|| sym::underscore);
         let (syntax, focus) = match &value {
             ModuleSource::SourceFile(node) => (node.syntax(), None),
             ModuleSource::Module(node) => (node.syntax(), node.name()),
             ModuleSource::BlockExpr(node) => (node.syntax(), None),
         };
 
-        orig_range_with_focus(db, file_id, syntax, focus).map(
-            |(
-                FileRange {
-                    file_id,
-                    range: full_range,
-                },
-                focus_range,
-            )| {
+        orig_range_with_focus(db, file_id, syntax, focus).map(|(FileRange { file_id, range: full_range }, focus_range)| {
                 NavigationTarget::from_syntax(
                     file_id,
                     name.clone(),
                     full_range,
                     SymbolKind::Module,
                 )
-            },
-        )
+            })
     }
 }
 
             None => (file_id, value.self_ty(), value.syntax()),
         };
 
-        Some(orig_range_with_focus(db, file_id, syntax, focus).map(
-            |(
-                FileRange {
-                    file_id,
-                    range: full_range,
-                },
-                focus_range,
-            )| {
+        Some(orig_range_with_focus(db, file_id, syntax, focus).map(|(FileRange { file_id, range: full_range }, focus_range)| {
                 NavigationTarget::from_syntax(
                     file_id,
                     sym::kw_impl,
                     full_range,
                     SymbolKind::Impl,
                 )
-            },
-        ))
+            }))
     }
 }
 
         let db = sema.db;
         let src = self.source(db)?;
         let InFile { file_id, value } = src;
-        let focus = value.rename().map_or_else(
-            || value.name_ref().map(Either::Left),
-            |it| it.name().map(Either::Right),
-        );
+        let focus = value
+            .rename()
+            .map_or_else(|| value.name_ref().map(Either::Left), |it| it.name().map(Either::Right));
         let krate = self.module(db).krate();
 
-        Some(
-            orig_range_with_focus(db, file_id, value.syntax(), focus).map(
-                |(
-                    FileRange {
-                        file_id,
-                        range: full_range,
-                    },
+        Some(orig_range_with_focus(db, file_id, value.syntax(), focus).map(|(FileRange { file_id, range: full_range }, focus_range)| {
+                let mut res = NavigationTarget::from_syntax(
+                    file_id,
+                    self.alias_or_name(db).unwrap_or_else(|| self.name(db)).symbol().clone(),
                     focus_range,
-                )| {
-                    let mut res = NavigationTarget::from_syntax(
-                        file_id,
-                        self.alias_or_name(db)
-                            .unwrap_or_else(|| self.name(db))
-                            .symbol()
-                            .clone(),
-                        focus_range,
-                        full_range,
-                        SymbolKind::Module,
-                    );
+                    full_range,
+                    SymbolKind::Module,
+                );
 
-                    res.docs = self.docs(db);
-                    res.description =
-                        Some(self.display(db, krate.to_display_target(db)).to_string());
-                    res.container_name = container_name(db, *self);
-                    res
-                },
-            ),
-        )
+                res.docs = self.docs(db);
+                res.description = Some(self.display(db, krate.to_display_target(db)).to_string());
+                res.container_name = container_name(db, *self);
+                res
+            }))
     }
 }
 
                 )
             }
             FieldSource::Pos(it) => orig_range(db, src.file_id, it.syntax()).map(
-                |(
-                    FileRange {
-                        file_id,
-                        range: full_range,
-                    },
-                    focus_range,
-                )| {
+                |(FileRange { file_id, range: full_range }, focus_range)| {
                     NavigationTarget::from_syntax(
                         file_id,
                         Symbol::integer(self.index()),
             Either::Right(it) => (it.syntax(), it.name()),
         };
 
-        orig_range_with_focus(db, file_id, node, name).map(
-            |(
-                FileRange {
-                    file_id,
-                    range: full_range,
-                },
-                focus_range,
-            )| {
+        orig_range_with_focus(db, file_id, node, name).map(|(FileRange { file_id, range: full_range }, focus_range)| {
                 let name = local.name(db).symbol().clone();
                 let kind = if local.is_self(db) {
                     SymbolKind::SelfParam
                     description: None,
                     docs: None,
                 }
-            },
-        )
+            })
     }
 }
 
         let InFile { file_id, value } = self.source(db)?;
         let name = self.name(db).symbol().clone();
 
-        Some(
-            orig_range_with_focus(db, file_id, value.syntax(), value.lifetime()).map(
-                |(
-                    FileRange {
-                        file_id,
-                        range: full_range,
-                    },
-                    focus_range,
-                )| NavigationTarget {
-                    file_id,
-                    name: name.clone(),
-                    alias: None,
-                    kind: Some(SymbolKind::Label),
-                    full_range,
-                    focus_range,
-                    container_name: None,
-                    description: None,
-                    docs: None,
-                },
-            ),
-        )
+        Some(orig_range_with_focus(db, file_id, value.syntax(), value.lifetime()).map(|(FileRange { file_id, range: full_range }, focus_range)| NavigationTarget {
+                file_id,
+                name: name.clone(),
+                alias: None,
+                kind: Some(SymbolKind::Label),
+                full_range,
+                focus_range,
+                container_name: None,
+                description: None,
+                docs: None,
+            }))
     }
 }
 
         };
         let focus = value.as_ref().either(|it| it.name(), |it| it.name());
 
-        Some(orig_range_with_focus(db, file_id, syntax, focus).map(
-            |(
-                FileRange {
-                    file_id,
-                    range: full_range,
-                },
-                focus_range,
-            )| NavigationTarget {
+        Some(orig_range_with_focus(db, file_id, syntax, focus).map(|(FileRange { file_id, range: full_range }, focus_range)| NavigationTarget {
                 file_id,
                 name: name.clone(),
                 alias: None,
                 container_name: None,
                 description: None,
                 docs: None,
-            },
-        ))
+            }))
     }
 }
 
         let InFile { file_id, value } = self.source(db)?;
         let name = self.name(db).symbol().clone();
 
-        Some(orig_range(db, file_id, value.syntax()).map(
-            |(
-                FileRange {
-                    file_id,
-                    range: full_range,
-                },
-                focus_range,
-            )| NavigationTarget {
+        Some(orig_range(db, file_id, value.syntax()).map(|(FileRange { file_id, range: full_range }, focus_range)| NavigationTarget {
                 file_id,
                 name: name.clone(),
                 alias: None,
                 container_name: None,
                 description: None,
                 docs: None,
-            },
-        ))
+            }))
     }
 }
 
             }
         };
 
-        Some(
-            orig_range_with_focus(db, file_id, value.syntax(), value.name()).map(
-                |(
-                    FileRange {
-                        file_id,
-                        range: full_range,
-                    },
-                    focus_range,
-                )| NavigationTarget {
-                    file_id,
-                    name: name.clone(),
-                    alias: None,
-                    kind: Some(SymbolKind::ConstParam),
-                    full_range,
-                    focus_range,
-                    container_name: None,
-                    description: None,
-                    docs: None,
-                },
-            ),
-        )
+        Some(orig_range_with_focus(db, file_id, value.syntax(), value.name()).map(|(FileRange { file_id, range: full_range }, focus_range)| NavigationTarget {
+                file_id,
+                name: name.clone(),
+                alias: None,
+                kind: Some(SymbolKind::ConstParam),
+                full_range,
+                focus_range,
+                container_name: None,
+                description: None,
+                docs: None,
+            }))
     }
 }
 
         let db = sema.db;
         let InFile { file_id, value } = &self.source(db)?;
         let file_id = *file_id;
-        Some(
-            orig_range_with_focus(db, file_id, value.syntax(), value.name()).map(
-                |(
-                    FileRange {
-                        file_id,
-                        range: full_range,
-                    },
-                    focus_range,
-                )| NavigationTarget {
-                    file_id,
-                    name: self
-                        .name(db)
-                        .map_or_else(|| sym::underscore.clone(), |it| it.symbol().clone()),
-                    alias: None,
-                    kind: Some(SymbolKind::Local),
-                    full_range,
-                    focus_range,
-                    container_name: None,
-                    description: None,
-                    docs: None,
-                },
-            ),
-        )
+        Some(orig_range_with_focus(db, file_id, value.syntax(), value.name()).map(|(FileRange { file_id, range: full_range }, focus_range)| NavigationTarget {
+                file_id,
+                name:
+                    self.name(db).map_or_else(|| sym::underscore.clone(), |it| it.symbol().clone()),
+                alias: None,
+                kind: Some(SymbolKind::Local),
+                full_range,
+                focus_range,
+                container_name: None,
+                description: None,
+                docs: None,
+            }))
     }
 }
 
             .all_crates()
             .iter()
             .copied()
-            .find(|&krate| {
-                matches!(
-                    krate.data(db).origin,
-                    CrateOrigin::Lang(LangCrateOrigin::Std)
-                )
-            })
+            .find(|&krate| matches!(krate.data(db).origin, CrateOrigin::Lang(LangCrateOrigin::Std)))
             .map(Crate::from)?;
         let edition = krate.edition(db);
 
     value: TextRange,
     focus_range: Option<TextRange>,
 ) -> UpmappingResult<(FileRange, Option<TextRange>)> {
-    let Some(name) = focus_range else {
-        return orig_range_r(db, hir_file, value);
-    };
+    let Some(name) = focus_range else { return orig_range_r(db, hir_file, value) };
 
-    let call_kind = || {
-        db.lookup_intern_macro_call(hir_file.macro_file().unwrap())
-            .kind
-    };
+    let call_kind = || db.lookup_intern_macro_call(hir_file.macro_file().unwrap()).kind;
 
-    let def_range = || {
-        db.lookup_intern_macro_call(hir_file.macro_file().unwrap())
-            .def
-            .definition_range(db)
-    };
+    let def_range =
+        || db.lookup_intern_macro_call(hir_file.macro_file().unwrap()).def.definition_range(db);
 
     // FIXME: Also make use of the syntax context to determine which site we are at?
     let value_range = InFile::new(hir_file, value).original_node_file_range_opt(db);
 ) -> UpmappingResult<(FileRange, Option<TextRange>)> {
     UpmappingResult {
         call_site: (
-            InFile::new(hir_file, value)
-                .original_file_range_rooted(db)
-                .into_file_id(db),
+            InFile::new(hir_file, value).original_file_range_rooted(db).into_file_id(db),
             None,
         ),
         def_site: None,
 ) -> UpmappingResult<(FileRange, Option<TextRange>)> {
     UpmappingResult {
         call_site: (
-            InFile::new(hir_file, value)
-                .original_node_file_range(db)
-                .0
-                .into_file_id(db),
+            InFile::new(hir_file, value).original_node_file_range(db).0.into_file_id(db),
             None,
         ),
         def_site: None,
 #[cfg(test)]
 mod tests {
     use expect_test::expect;
-
     use crate::{Query, fixture};
-
     #[test]
     fn test_nav_for_symbol() {
         let (analysis, _) = fixture::file(
 "#,
         );
 
-        let navs = analysis
-            .symbol_search(Query::new("FooInner".to_owned()), !0)
-            .unwrap();
+        let navs = analysis.symbol_search(Query::new("FooInner".to_owned()), !0).unwrap();
         expect![[r#"
             [
                 NavigationTarget {
         "#]]
         .assert_debug_eq(&navs);
     }
-
     #[test]
     fn test_world_symbols_are_case_sensitive() {
         let (analysis, _) = fixture::file(
 "#,
         );
 
-        let navs = analysis
-            .symbol_search(Query::new("foo".to_owned()), !0)
-            .unwrap();
+        let navs = analysis.symbol_search(Query::new("foo".to_owned()), !0).unwrap();
         assert_eq!(navs.len(), 2)
     }
-
     #[test]
     fn test_ensure_hidden_symbols_are_not_returned() {
         let (analysis, _) = fixture::file(
         );
 
         // It doesn't show the hidden symbol
-        let navs = analysis
-            .symbol_search(Query::new("foo".to_owned()), !0)
-            .unwrap();
+        let navs = analysis.symbol_search(Query::new("foo".to_owned()), !0).unwrap();
         assert_eq!(navs.len(), 2);
-        let navs = analysis
-            .symbol_search(Query::new("_foo".to_owned()), !0)
-            .unwrap();
+        let navs = analysis.symbol_search(Query::new("_foo".to_owned()), !0).unwrap();
         assert_eq!(navs.len(), 0);
 
         // Unless we explicitly search for a `__` prefix