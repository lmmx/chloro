COMPARISON DIFF
============================================================

Original size: 41840 bytes
Chloro size:   41715 bytes
Rustfmt size:  41840 bytes

âœ— Outputs DIFFER

=== DIFF (- rustfmt, + chloro) ===
 //! correct. Instead, we try to provide a best-effort service. Even if the
 //! project is currently loading and we don't have a full project model, we
 //! still want to respond to various  requests.
-// FIXME: This is a mess that needs some untangling work
+
 use std::{iter, mem};
 
-use hir::{ChangeWithProcMacros, ProcMacrosBuilder, db::DefDatabase};
+use hir::{db::DefDatabase, ChangeWithProcMacros, ProcMacrosBuilder};
 use ide_db::{
+    base_db::{salsa::Durability, CrateGraphBuilder, ProcMacroLoadingError, ProcMacroPaths},
     FxHashMap,
-    base_db::{CrateGraphBuilder, ProcMacroLoadingError, ProcMacroPaths, salsa::Durability},
 };
 use itertools::Itertools;
-use load_cargo::{ProjectFolders, load_proc_macro};
+use load_cargo::{load_proc_macro, ProjectFolders};
 use lsp_types::FileSystemWatcher;
 use paths::Utf8Path;
 use proc_macro_api::ProcMacroClient;
 use project_model::{ManifestPath, ProjectWorkspace, ProjectWorkspaceKind, WorkspaceBuildScripts};
 use stdx::{format_to, thread::ThreadIntent};
+use tracing::{debug, info};
 use triomphe::Arc;
 use vfs::{AbsPath, AbsPathBuf, ChangeKind};
 
     main_loop::{DiscoverProjectParam, Task},
     op_queue::Cause,
 };
-use tracing::{debug, info};
 
 #[derive(Debug)]
 pub(crate) enum ProjectWorkspaceProgress {
     /// This indicates that we've fully loaded the projects and
     /// are ready to do semantic work.
     pub(crate) fn is_quiescent(&self) -> bool {
-        self.vfs_done
-            && self.fetch_ws_receiver.is_none()
-            && !self.fetch_workspaces_queue.op_in_progress()
-            && !self.fetch_build_data_queue.op_in_progress()
-            && !self.fetch_proc_macros_queue.op_in_progress()
-            && !self.discover_workspace_queue.op_in_progress()
-            && self.vfs_progress_config_version >= self.vfs_config_version
+        self.vfs_done && self.fetch_ws_receiver.is_none() && !self.fetch_workspaces_queue.op_in_progress() && !self.fetch_build_data_queue.op_in_progress() && !self.fetch_proc_macros_queue.op_in_progress() && !self.discover_workspace_queue.op_in_progress() && self.vfs_progress_config_version >= self.vfs_config_version
     }
 
     /// Is the server ready to respond to analysis dependent LSP requests?
         );
 
         // crate graph construction relies on these paths, record them so when one of them gets
+
         // deleted or created we trigger a reconstruction of the crate graph
         self.crate_graph_file_dependencies.clear();
         self.detached_files = self
             }
         }
 
-        if buf.is_empty() { Ok(()) } else { Err(buf) }
+        if buf.is_empty() {
+            Ok(())
+        } else {
+            Err(buf)
+        }
     }
 
     fn reload_flycheck(&mut self) {
     }
 }
 
-// FIXME: Move this into load-cargo?
 pub fn ws_to_crate_graph(
     workspaces: &[ProjectWorkspace],
     extra_env: &FxHashMap<String, Option<String>>,
     s1.as_bytes().iter().zip(s2.as_bytes()).all(|(c1, c2)| {
         let c1_underscore = c1 == &b'_' || c1 == &b'-';
         let c2_underscore = c2 == &b'_' || c2 == &b'-';
-
         c1 == c2 || (c1_underscore && c2_underscore)
     })
 }