COMPARISON DIFF
============================================================

Original size: 38709 bytes
Chloro size:   38435 bytes
Rustfmt size:  39488 bytes

âœ— Outputs DIFFER

=== DIFF (- rustfmt, + chloro) ===
 use std::{collections::HashMap, path::PathBuf, time::Instant};
 
 use lsp_types::{
-    notification::DidOpenTextDocument,
-    request::{
-        CodeActionRequest, Completion, Formatting, GotoTypeDefinition, HoverRequest,
-        InlayHintRequest, InlayHintResolveRequest, RangeFormatting, WillRenameFiles,
-        WorkspaceSymbolRequest,
-    },
-    CodeActionContext, CodeActionParams, CompletionParams, DidOpenTextDocumentParams,
-    DocumentFormattingParams, DocumentRangeFormattingParams, FileRename, FormattingOptions,
-    GotoDefinitionParams, HoverParams, InlayHint, InlayHintLabel, InlayHintParams,
-    PartialResultParams, Position, Range, RenameFilesParams, TextDocumentItem,
-    TextDocumentPositionParams, WorkDoneProgressParams,
+    notification::DidOpenTextDocument, request::{
+        CodeActionRequest, CodeActionContext,
+    CodeActionParams, Completion, CompletionParams, DidOpenTextDocumentParams,
+    DocumentFormattingParams, DocumentRangeFormattingParams, FileRename, Formatting,
+    FormattingOptions, GotoDefinitionParams, GotoTypeDefinition, HoverParams, HoverRequest,
+    InlayHint, InlayHintLabel, InlayHintParams, InlayHintRequest, InlayHintResolveRequest,
+    PartialResultParams, Position, Range, RangeFormatting, RenameFilesParams, TextDocumentItem,
+    TextDocumentPositionParams, WillRenameFiles, WorkDoneProgressParams, WorkspaceSymbolRequest, },
 };
 use rust_analyzer::lsp::ext::{OnEnter, Runnables, RunnablesParams};
 use serde_json::json;
 use stdx::format_to_acc;
-
 use test_utils::skip_slow_tests;
 use testdir::TestDir;
 
-use crate::support::{project, Project};
+use crate::support::{Project, project};
 
 #[test]
 fn completes_items_from_standard_library() {
     if skip_slow_tests() {
         return;
     }
-
     let server = Project::with_fixture(
         r#"
 //- /Cargo.toml
     }))
     .server()
     .wait_until_workspace_is_loaded();
-
     let res = server.send_request::<Completion>(CompletionParams {
         text_document_position: TextDocumentPositionParams::new(
             server.doc_id("src/lib.rs"),
     if skip_slow_tests() {
         return;
     }
-
     let server = Project::with_fixture(
         r#"
 //- /Cargo.toml
     )
     .server()
     .wait_until_workspace_is_loaded();
-
     let res = server.send_request::<InlayHintRequest>(InlayHintParams {
         range: Range::new(Position::new(0, 0), Position::new(3, 1)),
         text_document: server.doc_id("src/lib.rs"),
         work_done_progress_params: WorkDoneProgressParams::default(),
     });
-    let mut hints = serde_json::from_value::<Option<Vec<InlayHint>>>(res)
-        .unwrap()
-        .unwrap();
+    let mut hints = serde_json::from_value::<Option<Vec<InlayHint>>>(res).unwrap().unwrap();
     let hint = hints.pop().unwrap();
     assert!(hint.data.is_some());
     assert!(
     if skip_slow_tests() || std::env::var("CI").is_ok() {
         return;
     }
-
     let server = Project::with_fixture(
         r#"
 //- /dependency/Cargo.toml
     }))
     .server()
     .wait_until_workspace_is_loaded();
-
     let res = server.send_request::<Completion>(CompletionParams {
         text_document_position: TextDocumentPositionParams::new(
             server.doc_id("src/lib.rs"),
         partial_result_params: PartialResultParams::default(),
         work_done_progress_params: WorkDoneProgressParams::default(),
     });
-    assert!(
-        res.to_string().contains("SpecialHashMap"),
-        "{}",
-        res.to_string()
-    );
-
+    assert!(res.to_string().contains("SpecialHashMap"), "{}", res.to_string());
     let res = server.send_request::<Completion>(CompletionParams {
         text_document_position: TextDocumentPositionParams::new(
             server.doc_id("src/lib.rs"),
         work_done_progress_params: WorkDoneProgressParams::default(),
     });
     assert!(!res.to_string().contains("SpecialHashMap"));
-
     server.write_file_and_save(
         "src/lib.rs",
         r#"#!/usr/bin/env -S cargo +nightly -Zscript
 "#
         .to_owned(),
     );
-
     let server = server.wait_until_workspace_is_loaded();
-
     std::thread::sleep(std::time::Duration::from_secs(3));
-
     let res = server.send_request::<Completion>(CompletionParams {
         text_document_position: TextDocumentPositionParams::new(
             server.doc_id("src/lib.rs"),
         work_done_progress_params: WorkDoneProgressParams::default(),
     });
     assert!(!res.to_string().contains("SpecialHashMap"));
-
     let res = server.send_request::<Completion>(CompletionParams {
         text_document_position: TextDocumentPositionParams::new(
             server.doc_id("src/lib.rs"),
     if skip_slow_tests() {
         return;
     }
-
     let server = Project::with_fixture(
         r#"
 //- /foo/Cargo.toml
     .root("bar")
     .server()
     .wait_until_workspace_is_loaded();
-
     server.request::<Runnables>(
-        RunnablesParams {
-            text_document: server.doc_id("foo/tests/spam.rs"),
-            position: None,
-        },
+        RunnablesParams { text_document: server.doc_id("foo/tests/spam.rs"), position: None },
         json!([
           {
             "args": {
     );
 }
 
-// Each package in these workspaces should be run from its own root
 #[test]
 fn test_path_dependency_runnables() {
     if skip_slow_tests() {
         return;
     }
-
     let server = Project::with_fixture(
         r#"
 //- /consumer/Cargo.toml
     .root("devdependency")
     .server()
     .wait_until_workspace_is_loaded();
-
     for runnable in ["consumer", "dependency", "devdependency"] {
         server.request::<Runnables>(
             RunnablesParams {
     }
 }
 
-// The main fn in packages should be run from the workspace root
 #[test]
 fn test_runnables_cwd() {
     if skip_slow_tests() {
         return;
     }
-
     let server = Project::with_fixture(
         r#"
 //- /foo/Cargo.toml
     .root("foo")
     .server()
     .wait_until_workspace_is_loaded();
-
     server.request::<Runnables>(
-        RunnablesParams {
-            text_document: server.doc_id("foo/mainpkg/src/main.rs"),
-            position: None,
-        },
+        RunnablesParams { text_document: server.doc_id("foo/mainpkg/src/main.rs"), position: None },
         json!([
             "{...}",
             {
             "{...}"
         ]),
     );
-
     server.request::<Runnables>(
-        RunnablesParams {
-            text_document: server.doc_id("foo/otherpkg/src/lib.rs"),
-            position: None,
-        },
+        RunnablesParams { text_document: server.doc_id("foo/otherpkg/src/lib.rs"), position: None },
         json!([
             "{...}",
             {
     if skip_slow_tests() {
         return;
     }
-
     let server = project(
         r#"
 //- /Cargo.toml
 "#,
     )
     .wait_until_workspace_is_loaded();
-
     server.request::<Formatting>(
         DocumentFormattingParams {
             text_document: server.doc_id("src/lib.rs"),
     if skip_slow_tests() {
         return;
     }
-
     let server = project(
         r#"
 //- /Cargo.toml
 "#,
     )
     .wait_until_workspace_is_loaded();
-
     server.request::<Formatting>(
         DocumentFormattingParams {
             text_document: server.doc_id("src/lib.rs"),
     if skip_slow_tests() {
         return;
     }
-
     let server = project(
         r#"
 //- /Cargo.toml
 "#,
     )
     .wait_until_workspace_is_loaded();
-
     server.request::<Formatting>(
         DocumentFormattingParams {
             text_document: server.doc_id("src/lib.rs"),
     if skip_slow_tests() {
         return;
     }
-
     let server = Project::with_fixture(
         r#"
 //- /Cargo.toml
     }))
     .server()
     .wait_until_workspace_is_loaded();
-
     server.request::<RangeFormatting>(
         DocumentRangeFormattingParams {
             range: Range {
-                end: Position {
-                    line: 1,
-                    character: 0,
-                },
-                start: Position {
-                    line: 1,
-                    character: 0,
-                },
+                end: Position { line: 1, character: 0 },
+                start: Position { line: 1, character: 0 },
             },
             text_document: server.doc_id("src/lib.rs"),
             options: FormattingOptions {
     if skip_slow_tests() {
         return;
     }
-
     let server = project(
         r#"
 //- /Cargo.toml
 "#,
     )
     .wait_until_workspace_is_loaded();
-
     server.request::<CodeActionRequest>(
         CodeActionParams {
             text_document: server.doc_id("src/lib.rs"),
             }
         ]),
     );
-
     server.request::<CodeActionRequest>(
         CodeActionParams {
             text_document: server.doc_id("src/lib.rs"),
     if skip_slow_tests() {
         return;
     }
-
     let tmp_dir = TestDir::new();
-
     let path = tmp_dir.path();
-
     let project = json!({
         "roots": [path],
         "crates": [ {
             "cfg": [ "cfg_atom_1", "feature=\"cfg_1\""],
         } ]
     });
-
     let code = format!(
         r#"
 //- /.rust-project.json
 fn main() {{}}
 "#,
     );
-
-    let server = Project::with_fixture(&code)
-        .tmp_dir(tmp_dir)
-        .server()
-        .wait_until_workspace_is_loaded();
-
+    let server =
+        Project::with_fixture(&code).tmp_dir(tmp_dir).server().wait_until_workspace_is_loaded();
     server.request::<CodeActionRequest>(
         CodeActionParams {
             text_document: server.doc_id("src/lib.rs"),
             }
         ]),
     );
-
     server.request::<CodeActionRequest>(
         CodeActionParams {
             text_document: server.doc_id("src/lib.rs"),
         // FIXME: This test is failing too frequently (therefore we disable it on CI).
         return;
     }
-
     let librs: String = (0..10).fold(String::new(), |mut acc, i| format_to_acc!(acc, "mod m{i};"));
     let libs: String = (0..10).fold(String::new(), |mut acc, i| {
         format_to_acc!(acc, "//- /src/m{i}.rs\nfn foo() {{}}\n\n")
     }))
     .server()
     .wait_until_workspace_is_loaded();
-
     for i in 0..10 {
         server.notification::<DidOpenTextDocument>(DidOpenTextDocumentParams {
             text_document: TextDocumentItem {
     server.request::<OnEnter>(
         TextDocumentPositionParams {
             text_document: server.doc_id("src/m0.rs"),
-            position: Position {
-                line: 0,
-                character: 5,
-            },
+            position: Position { line: 0, character: 5 },
         },
         json!([{
             "insertTextFormat": 2,
     if skip_slow_tests() {
         return;
     }
-
     let server = Project::with_fixture(
         "
 //- /Cargo.toml
     )
     .server()
     .wait_until_workspace_is_loaded();
-
     server.request::<OnEnter>(
         TextDocumentPositionParams {
             text_document: server.doc_id("src/main.rs"),
-            position: Position {
-                line: 0,
-                character: 8,
-            },
+            position: Position { line: 0, character: 8 },
         },
         json!([{
             "insertTextFormat": 2,
 }
 "###,
     );
-
     if root_contains_symlink {
         server = server.with_root_dir_contains_symlink();
     }
-
     let server = server
         .with_config(serde_json::json!({
             "cargo": {
         }))
         .server()
         .wait_until_workspace_is_loaded();
-
     let res = server.send_request::<HoverRequest>(HoverParams {
         text_document_position_params: TextDocumentPositionParams::new(
             server.doc_id("src/main.rs"),
         work_done_progress_params: Default::default(),
     });
     assert!(res.to_string().contains("&str"));
-
     let res = server.send_request::<HoverRequest>(HoverParams {
         text_document_position_params: TextDocumentPositionParams::new(
             server.doc_id("src/main.rs"),
         work_done_progress_params: Default::default(),
     });
     assert!(res.to_string().contains("&str"));
-
     server.request::<GotoTypeDefinition>(
         GotoDefinitionParams {
             text_document_position_params: TextDocumentPositionParams::new(
             "targetUri": "file:///[..]src/main.rs"
         }]),
     );
-
     server.request::<GotoTypeDefinition>(
         GotoDefinitionParams {
             text_document_position_params: TextDocumentPositionParams::new(
 }
 
 #[test]
-#[cfg(not(windows))] // windows requires elevated permissions to create symlinks
+#[cfg(not(windows))]
 fn root_contains_symlink_out_dirs_check() {
     if skip_slow_tests() {
         return;
     if skip_slow_tests() {
         return;
     }
-
     let server = Project::with_fixture(
         r###"
 //- /foo/Cargo.toml
     .root("bar")
     .server()
     .wait_until_workspace_is_loaded();
-
     let res = server.send_request::<HoverRequest>(HoverParams {
         text_document_position_params: TextDocumentPositionParams::new(
             server.doc_id("foo/src/main.rs"),
         ),
         work_done_progress_params: Default::default(),
     });
-    let value = res
-        .get("contents")
-        .unwrap()
-        .get("value")
-        .unwrap()
-        .as_str()
-        .unwrap();
-
+    let value = res.get("contents").unwrap().get("value").unwrap().as_str().unwrap();
     expect![[r#"
 
         ```rust
     if skip_slow_tests() {
         return;
     }
-
     let tmp_dir = TestDir::new();
     let tmp_dir_path = tmp_dir.path().to_owned();
     let tmp_dir_str = tmp_dir_path.as_str();
     let base_path = PathBuf::from(format!("file://{tmp_dir_str}"));
-
     let code = r#"
 //- /Cargo.toml
 [package]
 //- /src/to_mod/foo.rs
 
 "#;
-    let server = Project::with_fixture(code)
-        .tmp_dir(tmp_dir)
-        .server()
-        .wait_until_workspace_is_loaded();
-
+    let server =
+        Project::with_fixture(code).tmp_dir(tmp_dir).server().wait_until_workspace_is_loaded();
     //rename same level file
     server.request::<WillRenameFiles>(
         RenameFilesParams {
           ]
         }),
     );
-
     //rename file from mod.rs to foo.rs
     server.request::<WillRenameFiles>(
         RenameFilesParams {
             files: vec![FileRename {
-                old_uri: base_path
-                    .join("src/from_mod/mod.rs")
-                    .to_str()
-                    .unwrap()
-                    .to_owned(),
-                new_uri: base_path
-                    .join("src/from_mod/foo.rs")
-                    .to_str()
-                    .unwrap()
-                    .to_owned(),
+                old_uri: base_path.join("src/from_mod/mod.rs").to_str().unwrap().to_owned(),
+                new_uri: base_path.join("src/from_mod/foo.rs").to_str().unwrap().to_owned(),
             }],
         },
         json!(null),
     );
-
     //rename file from foo.rs to mod.rs
     server.request::<WillRenameFiles>(
         RenameFilesParams {
             files: vec![FileRename {
-                old_uri: base_path
-                    .join("src/to_mod/foo.rs")
-                    .to_str()
-                    .unwrap()
-                    .to_owned(),
-                new_uri: base_path
-                    .join("src/to_mod/mod.rs")
-                    .to_str()
-                    .unwrap()
-                    .to_owned(),
+                old_uri: base_path.join("src/to_mod/foo.rs").to_str().unwrap().to_owned(),
+                new_uri: base_path.join("src/to_mod/mod.rs").to_str().unwrap().to_owned(),
             }],
         },
         json!(null),
     );
-
     //rename same level file
     server.request::<WillRenameFiles>(
         RenameFilesParams {
     if skip_slow_tests() {
         return;
     }
-
     let server = Project::with_fixture(
         r#"
 //- /foo/Cargo.toml
     }))
     .server()
     .wait_until_workspace_is_loaded();
-
     server.request::<WorkspaceSymbolRequest>(Default::default(), json!([]));
-
     let server = Project::with_fixture(
         r#"
 //- /foo/Cargo.toml
     }))
     .server()
     .wait_until_workspace_is_loaded();
-
     server.request::<WorkspaceSymbolRequest>(Default::default(), json!([]));
 }