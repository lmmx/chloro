COMPARISON DIFF
============================================================

Original size: 11991 bytes
Chloro size:   11857 bytes
Rustfmt size:  11991 bytes

âœ— Outputs DIFFER

=== DIFF (- rustfmt, + chloro) ===
 
 use std::iter;
 
-use crate::expr_store::{
-    lower::{ExprCollector, generics::ImplTraitLowerFn},
-    path::NormalPath,
-};
-
 use hir_expand::{
-    mod_path::{ModPath, PathKind, resolve_crate_root},
+    mod_path::{resolve_crate_root, ModPath, PathKind},
     name::{AsName, Name},
 };
 use intern::{Interned, sym};
 use syntax::{
-    AstPtr,
     ast::{self, AstNode, HasGenericArgs},
+    AstPtr,
 };
 
+use crate::expr_store::{
+    lower::{generics::ImplTraitLowerFn, ExprCollector},
+    path::NormalPath,
+};
 use crate::{
     expr_store::path::{GenericArg, GenericArgs, Path},
     type_ref::TypeRef,
 };
 
-#[cfg(test)]
 thread_local! {
     /// This is used to test `hir_segment_to_ast_segment()`. It's a hack, but it makes testing much easier.
     pub(super) static SEGMENT_LOWERING_MAP: std::cell::RefCell<rustc_hash::FxHashMap<ast::PathSegment, usize>> = std::cell::RefCell::default();
 
 /// Converts an `ast::Path` to `Path`. Works with use trees.
 /// It correctly handles `$crate` based path from macro call.
-// If you modify the logic of the lowering, make sure to check if `hir_segment_to_ast_segment()`
-// also needs an update.
 pub(super) fn lower_path(
     collector: &mut ExprCollector<'_>,
     mut path: ast::Path,
     }
 
     // handle local_inner_macros :
+
     // Basically, even in rustc it is quite hacky:
+
     // https://github.com/rust-lang/rust/blob/614f273e9388ddd7804d5cbc80b8865068a3744e/src/librustc_resolve/macros.rs#L456
+
     // We follow what it did anyway :)
     if segments.len() == 1
         && kind == PathKind::Plain
 pub fn hir_segment_to_ast_segment(path: &ast::Path, segment_idx: u32) -> Option<ast::PathSegment> {
     // Too tightly coupled to `lower_path()`, but unfortunately we cannot decouple them,
     // as keeping source maps for all paths segments will have a severe impact on memory usage.
-
     let mut segments = path.segments();
     if let Some(ast::PathSegmentKind::Type { trait_ref: Some(trait_ref), .. }) =
         segments.clone().next().and_then(|it| it.kind())