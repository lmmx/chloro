COMPARISON DIFF
============================================================

Original size: 13440 bytes
Chloro size:   13410 bytes
Rustfmt size:  13679 bytes

âœ— Outputs DIFFER

--- DIFF (- rustfmt, + chloro) ---
     FilePosition, TextSize,
 };
 use ide_db::{
-    imports::insert_use::{ImportGranularity, InsertUseConfig},
     MiniCore, SnippetCap,
+    imports::insert_use::{ImportGranularity, InsertUseConfig},
 };
+use load_cargo::{LoadCargoConfig, ProcMacroServerChoice, load_workspace_at};
 use project_model::CargoConfig;
 use test_utils::project_root;
 use vfs::{AbsPathBuf, VfsPath};
-
-use load_cargo::{load_workspace_at, LoadCargoConfig, ProcMacroServerChoice};
-
 #[track_caller]
 fn file_id(vfs: &vfs::Vfs, path: &VfsPath) -> vfs::FileId {
     match vfs.file_id(path) {
     if std::env::var("RUN_SLOW_BENCHES").is_err() {
         return;
     }
-
     // Load rust-analyzer itself.
     let workspace_to_load = project_root();
     let file = "./crates/rust-analyzer/src/config.rs";
-
     let cargo_config = CargoConfig {
         sysroot: Some(project_model::RustLibSource::Discover),
         all_targets: true,
         with_proc_macro_server: ProcMacroServerChoice::Sysroot,
         prefill_caches: false,
     };
-
     let (db, vfs, _proc_macro) = {
         let _it = stdx::timeit("workspace loading");
         load_workspace_at(
         .unwrap()
     };
     let mut host = AnalysisHost::with_database(db);
-
     let file_id = {
         let file = workspace_to_load.join(file);
         let path = VfsPath::from(AbsPathBuf::assert(file));
         file_id(&vfs, &path)
     };
-
     {
         let _it = stdx::timeit("initial");
         let analysis = host.analysis();
         analysis.highlight_as_html(file_id, false).unwrap();
     }
-
     {
         let _it = stdx::timeit("change");
         let mut text = host.analysis().file_text(file_id).unwrap().to_string();
         change.change_file(file_id, Some(text));
         host.apply_change(change);
     }
-
     let _g = crate::tracing::hprof::init("*>10");
-
     {
         let _it = stdx::timeit("after change");
         let _span = profile::cpu_span();
     if std::env::var("RUN_SLOW_BENCHES").is_err() {
         return;
     }
-
     // Load rust-analyzer itself.
     let workspace_to_load = project_root();
     let file = "./crates/hir/src/lib.rs";
-
     let cargo_config = CargoConfig {
         sysroot: Some(project_model::RustLibSource::Discover),
         all_targets: true,
         with_proc_macro_server: ProcMacroServerChoice::Sysroot,
         prefill_caches: true,
     };
-
     let (db, vfs, _proc_macro) = {
         let _it = stdx::timeit("workspace loading");
         load_workspace_at(
         .unwrap()
     };
     let mut host = AnalysisHost::with_database(db);
-
     let file_id = {
         let file = workspace_to_load.join(file);
         let path = VfsPath::from(AbsPathBuf::assert(file));
         file_id(&vfs, &path)
     };
-
     // kick off parsing and index population
-
     let completion_offset = {
         let _it = stdx::timeit("change");
         let mut text = host.analysis().file_text(file_id).unwrap().to_string();
-        let completion_offset = patch(
-            &mut text,
-            "db.struct_signature(self.id)",
-            "sel;\ndb.struct_signature(self.id)",
-        ) + "sel".len();
+        let completion_offset =
+            patch(&mut text, "db.struct_signature(self.id)", "sel;\ndb.struct_signature(self.id)")
+                + "sel".len();
         let mut change = ChangeWithProcMacros::default();
         change.change_file(file_id, Some(text));
         host.apply_change(change);
         completion_offset
     };
-
     {
         let _span = profile::cpu_span();
         let analysis = host.analysis();
             enable_auto_iter: true,
             minicore: MiniCore::default(),
         };
-        let position = FilePosition {
-            file_id,
-            offset: TextSize::try_from(completion_offset).unwrap(),
-        };
+        let position =
+            FilePosition { file_id, offset: TextSize::try_from(completion_offset).unwrap() };
         analysis.completions(&config, position, None).unwrap();
     }
-
     let _g = crate::tracing::hprof::init("*>10");
-
     let completion_offset = {
         let _it = stdx::timeit("change");
         let mut text = host.analysis().file_text(file_id).unwrap().to_string();
         host.apply_change(change);
         completion_offset
     };
-
     {
         let _p = tracing::info_span!("unqualified path completion").entered();
         let _span = profile::cpu_span();
             enable_auto_iter: true,
             minicore: MiniCore::default(),
         };
-        let position = FilePosition {
-            file_id,
-            offset: TextSize::try_from(completion_offset).unwrap(),
-        };
+        let position =
+            FilePosition { file_id, offset: TextSize::try_from(completion_offset).unwrap() };
         analysis.completions(&config, position, None).unwrap();
     }
-
     let completion_offset = {
         let _it = stdx::timeit("change");
         let mut text = host.analysis().file_text(file_id).unwrap().to_string();
         host.apply_change(change);
         completion_offset
     };
-
     {
         let _p = tracing::info_span!("dot completion").entered();
         let _span = profile::cpu_span();
             enable_auto_iter: true,
             minicore: MiniCore::default(),
         };
-        let position = FilePosition {
-            file_id,
-            offset: TextSize::try_from(completion_offset).unwrap(),
-        };
+        let position =
+            FilePosition { file_id, offset: TextSize::try_from(completion_offset).unwrap() };
         analysis.completions(&config, position, None).unwrap();
     }
 }
     if std::env::var("RUN_SLOW_BENCHES").is_err() {
         return;
     }
-
     // Load rust-analyzer itself.
     let workspace_to_load = project_root();
     let file = "./crates/hir/src/lib.rs";
-
     let cargo_config = CargoConfig {
         sysroot: Some(project_model::RustLibSource::Discover),
         all_targets: true,
         with_proc_macro_server: ProcMacroServerChoice::Sysroot,
         prefill_caches: true,
     };
-
     let (db, vfs, _proc_macro) = {
         let _it = stdx::timeit("workspace loading");
         load_workspace_at(
         .unwrap()
     };
     let mut host = AnalysisHost::with_database(db);
-
     let file_id = {
         let file = workspace_to_load.join(file);
         let path = VfsPath::from(AbsPathBuf::assert(file));
         file_id(&vfs, &path)
     };
-
     let diagnostics_config = DiagnosticsConfig {
         enabled: false,
         proc_macros_enabled: true,
         term_search_borrowck: true,
     };
     host.analysis()
-        .full_diagnostics(
-            &diagnostics_config,
-            ide::AssistResolveStrategy::None,
-            file_id,
-        )
+        .full_diagnostics(&diagnostics_config, ide::AssistResolveStrategy::None, file_id)
         .unwrap();
-
     let _g = crate::tracing::hprof::init("*");
-
     {
         let _it = stdx::timeit("change");
         let mut text = host.analysis().file_text(file_id).unwrap().to_string();
-        patch(
-            &mut text,
-            "db.struct_signature(self.id)",
-            "();\ndb.struct_signature(self.id)",
-        );
+        patch(&mut text, "db.struct_signature(self.id)", "();\ndb.struct_signature(self.id)");
         let mut change = ChangeWithProcMacros::default();
         change.change_file(file_id, Some(text));
         host.apply_change(change);
     };
-
     {
         let _p = tracing::info_span!("diagnostics").entered();
         let _span = profile::cpu_span();
         host.analysis()
-            .full_diagnostics(
-                &diagnostics_config,
-                ide::AssistResolveStrategy::None,
-                file_id,
-            )
+            .full_diagnostics(&diagnostics_config, ide::AssistResolveStrategy::None, file_id)
             .unwrap();
     }
 }