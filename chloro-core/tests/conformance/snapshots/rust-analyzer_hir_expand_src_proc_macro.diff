COMPARISON DIFF
============================================================

Original size: 12654 bytes
Chloro size:   12162 bytes
Rustfmt size:  13004 bytes

âœ— Outputs DIFFER

--- DIFF (- rustfmt, + chloro) ---
 use span::Span;
 use triomphe::Arc;
 
-use crate::{db::ExpandDatabase, tt, ExpandError, ExpandErrorKind, ExpandResult};
-
+use crate::{ExpandError, ExpandErrorKind, ExpandResult, db::ExpandDatabase, tt};
 #[derive(Copy, Clone, Eq, PartialEq, PartialOrd, Ord, Debug, Hash)]
 pub enum ProcMacroKind {
     CustomDerive,
 }
 
 /// A proc-macro expander implementation.
-pub trait ProcMacroExpander: fmt::Debug + Send + Sync + RefUnwindSafe + Any {
-    /// Run the expander with the given input subtree, optional attribute input subtree (for
-    /// [`ProcMacroKind::Attr`]), environment variables, and span information.
-    fn expand(
-        &self,
-        subtree: &tt::TopSubtree,
-        attrs: Option<&tt::TopSubtree>,
-        env: &Env,
-        def_site: Span,
-        call_site: Span,
-        mixed_site: Span,
-        current_dir: String,
-    ) -> Result<tt::TopSubtree, ProcMacroExpansionError>;
-
-    fn eq_dyn(&self, other: &dyn ProcMacroExpander) -> bool;
-}
+/// Run the expander with the given input subtree, optional attribute input subtree (for
+/// [`ProcMacroKind::Attr`]), environment variables, and span information.
+fn expand(&self, subtree: &tt::TopSubtree, attrs: Option<&tt::TopSubtree>, env: &Env, def_site: Span, call_site: Span, mixed_site: Span, current_dir: String) -> Result<tt::TopSubtree, ProcMacroExpansionError>;
+fn eq_dyn(&self, other: &dyn ProcMacroExpander) -> bool;
 
 impl PartialEq for dyn ProcMacroExpander {
     fn eq(&self, other: &Self) -> bool {
     }
 }
 
-impl Eq for dyn ProcMacroExpander {}
+impl Eq for dyn ProcMacroExpander {
+}
 
 #[derive(Debug)]
 pub enum ProcMacroExpansionError {
 }
 
 pub type ProcMacroLoadResult = Result<Vec<ProcMacro>, ProcMacroLoadingError>;
+
 type StoredProcMacroLoadResult = Result<Box<[ProcMacro]>, ProcMacroLoadingError>;
 
 #[derive(Default, Debug)]
 pub struct ProcMacrosBuilder(FxHashMap<CrateBuilderId, Arc<CrateProcMacros>>);
 
 impl ProcMacrosBuilder {
-    pub fn insert(
-        &mut self,
-        proc_macros_crate: CrateBuilderId,
-        mut proc_macro: ProcMacroLoadResult,
-    ) {
+    pub fn insert(&mut self, proc_macros_crate: CrateBuilderId, mut proc_macro: ProcMacroLoadResult) {
         if let Ok(proc_macros) = &mut proc_macro {
             // Sort proc macros to improve incrementality when only their order has changed (ideally the build system
             // will not change their order, but just to be sure).
 
 #[derive(Default, Debug)]
 pub struct ProcMacros(FxHashMap<Crate, Arc<CrateProcMacros>>);
+
 impl ProcMacros {
     fn get(&self, krate: Crate) -> Option<Arc<CrateProcMacros>> {
         self.0.get(&krate).cloned()
     }
 
     /// Fetch the [`CustomProcMacroExpander`]s and their corresponding names for the given crate.
-    pub fn list(
-        &self,
-        def_site_ctx: span::SyntaxContext,
-    ) -> Option<Box<[(crate::name::Name, CustomProcMacroExpander, bool)]>> {
+    pub fn list(&self, def_site_ctx: span::SyntaxContext) -> Option<Box<[(crate::name::Name, CustomProcMacroExpander, bool)]>> {
         match &self.0 {
             Ok(proc_macros) => Some(
                 proc_macros
     pub disabled: bool,
 }
 
-// `#[derive(PartialEq)]` generates a strange "cannot move" error.
 impl PartialEq for ProcMacro {
     fn eq(&self, other: &Self) -> bool {
-        let Self {
-            name,
-            kind,
-            expander,
-            disabled,
-        } = self;
+        let Self { name, kind, expander, disabled } = self;
         let Self {
             name: other_name,
             kind: other_kind,
 }
 
 impl CustomProcMacroExpander {
-    const MISSING_EXPANDER: u32 = !0;
-    const DISABLED_ID: u32 = !1;
-    const PROC_MACRO_ATTR_DISABLED: u32 = !2;
+
+
 
     pub fn new(proc_macro_id: u32) -> Self {
         assert_ne!(proc_macro_id, Self::MISSING_EXPANDER);
 
     /// An expander that always errors due to the actual proc-macro expander missing.
     pub const fn missing_expander() -> Self {
-        Self {
-            proc_macro_id: Self::MISSING_EXPANDER,
-        }
+        Self { proc_macro_id: Self::MISSING_EXPANDER }
     }
 
     /// A dummy expander that always errors. This expander is used for macros that have been disabled.
     pub const fn disabled() -> Self {
-        Self {
-            proc_macro_id: Self::DISABLED_ID,
-        }
+        Self { proc_macro_id: Self::DISABLED_ID }
     }
 
     /// A dummy expander that always errors. This expander is used for attribute macros when
     /// proc-macro attribute expansion is disabled.
     pub const fn disabled_proc_attr() -> Self {
-        Self {
-            proc_macro_id: Self::PROC_MACRO_ATTR_DISABLED,
-        }
+        Self { proc_macro_id: Self::PROC_MACRO_ATTR_DISABLED }
     }
 
     /// The macro-expander is missing or has yet to be build.
         }
     }
 
-    pub fn expand(
-        self,
-        db: &dyn ExpandDatabase,
-        def_crate: Crate,
-        calling_crate: Crate,
-        tt: &tt::TopSubtree,
-        attr_arg: Option<&tt::TopSubtree>,
-        def_site: Span,
-        call_site: Span,
-        mixed_site: Span,
-    ) -> ExpandResult<tt::TopSubtree> {
+    pub fn expand(self, db: &dyn ExpandDatabase, def_crate: Crate, calling_crate: Crate, tt: &tt::TopSubtree, attr_arg: Option<&tt::TopSubtree>, def_site: Span, call_site: Span, mixed_site: Span) -> ExpandResult<tt::TopSubtree> {
         match self.proc_macro_id {
             Self::PROC_MACRO_ATTR_DISABLED => ExpandResult::new(
-                tt::TopSubtree::empty(tt::DelimSpan {
-                    open: call_site,
-                    close: call_site,
-                }),
+                tt::TopSubtree::empty(tt::DelimSpan { open: call_site, close: call_site }),
                 ExpandError::new(call_site, ExpandErrorKind::ProcMacroAttrExpansionDisabled),
             ),
             Self::MISSING_EXPANDER => ExpandResult::new(
-                tt::TopSubtree::empty(tt::DelimSpan {
-                    open: call_site,
-                    close: call_site,
-                }),
-                ExpandError::new(
-                    call_site,
-                    ExpandErrorKind::MissingProcMacroExpander(def_crate),
-                ),
+                tt::TopSubtree::empty(tt::DelimSpan { open: call_site, close: call_site }),
+                ExpandError::new(call_site, ExpandErrorKind::MissingProcMacroExpander(def_crate)),
             ),
             Self::DISABLED_ID => ExpandResult::new(
-                tt::TopSubtree::empty(tt::DelimSpan {
-                    open: call_site,
-                    close: call_site,
-                }),
+                tt::TopSubtree::empty(tt::DelimSpan { open: call_site, close: call_site }),
                 ExpandError::new(call_site, ExpandErrorKind::MacroDisabled),
             ),
             id => {
     }
 }
 
-pub(crate) fn proc_macros_for_crate(
-    db: &dyn ExpandDatabase,
-    krate: Crate,
-) -> Option<Arc<CrateProcMacros>> {
+pub(crate) fn proc_macros_for_crate(db: &dyn ExpandDatabase, krate: Crate) -> Option<Arc<CrateProcMacros>> {
     db.proc_macros().get(krate)
 }